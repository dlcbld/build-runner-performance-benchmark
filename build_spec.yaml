version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash

env:
  exportedVariables:
    - GEEKBENCH_REPORTS_URL
    - TIME_TAKEN_1GB

steps:
  - type: Command
    name: "Run Speedtest"
    timeoutInSeconds: 3600
    command: |
      echo "Install Speedtest CLI"
      curl -LO https://install.speedtest.net/app/cli/ookla-speedtest-1.1.1-linux-x86_64.tgz
      tar -zxf ookla-speedtest-1.1.1-linux-x86_64.tgz
      ./speedtest > SpeedtestOutput.txt 2>&1
      cat SpeedtestOutput.txt
  - type: Command
    name: "Download 1GB file"
    timeoutInSeconds: 3600
    command: |
      echo "Downloading file of 1GB"
      START_TIME=`date`
      curl -L -o "File1GB" https://speedtest-ny.turnkeyinternet.net/1000mb.bin
      END_TIME=`date`
      echo "Completed downloading file of 1GB
      sdt=$( date -d "$START_TIME" +%s )
      edt=$( date -d "$END_TIME" +%s )
      TIME_TAKEN_1GB=$((edt-sdt))
      echo "$edt $sdt" | awk ' { printf("It took %f seconds to download\n", ($1-$2)); } '
  - type: Command
    name: "Run Geekbench"
    timeoutInSeconds: 3600
    command: |
      echo "Download Geekbench"
      wget http://cdn.geekbench.com/Geekbench-5.2.3-Linux.tar.gz
      echo "Untar Geekbench"
      tar xf Geekbench-5.2.3-Linux.tar.gz
      echo "Run Geekbench"
      cd Geekbench-5.2.3-Linux
      ./geekbench5 > GeekbenchOutput.txt 2>&1
      echo "Completed running Geekbench"
      cat GeekbenchOutput.txt
      GEEKBENCH_REPORTS_URL=`grep "browser.geekbench.com" GeekbenchOutput.txt | grep -v claim`
      echo "View reports: $GEEKBENCH_REPORTS_URL"

outputArtifacts:
  - name: File1GB
    type: BINARY
    location: File1GB
