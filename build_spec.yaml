version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash

env:
  exportedVariables:
    - GEEKBENCH_REPORTS_URL

steps:
  - type: Command
    name: "Run Geekbench"
    timeoutInSeconds: 3600
    command: |
      echo "Download Geekbench"
      wget http://cdn.geekbench.com/Geekbench-5.2.3-Linux.tar.gz
      echo "Untar Geekbench"
      tar xf Geekbench-5.2.3-Linux.tar.gz
      echo "Run Geekbench"
      cd Geekbench-5.2.3-Linux
      ./geekbench5 > GeekbenchOutput.txt 2>&1
      echo "Completed running Geekbench"
      cat GeekbenchOutput.txt
      GEEKBENCH_REPORTS_URL=`grep "browser.geekbench.com" GeekbenchOutput.txt | grep -v claim`
      echo "View reports: $GEEKBENCH_REPORTS_URL"
